!function(e){"use strict";function t(e){return"chip"}function n(e){return e?e.toString():e}function d(e){return this.itemValue(e)}function l(e){return null}function i(e,a){a.hide().fadeIn()}function r(a,t){this.itemsArray=[],this.$element=e(a),this.$element.hide(),this.objectItems=t&&t.itemValue,this.placeholderText=a.hasAttribute("placeholder")?this.$element.attr("placeholder"):"",this.inputSize=Math.max(1,this.placeholderText.length),this.$container=e('<div class="materialize-tags"></div>'),this.$input=e('<input type="text" class="n-tag"  placeholder="'+this.placeholderText+'"/>').appendTo(this.$container),this.$label=this.$element.parent().find("label"),this.$element.before(this.$container),this.build(t),this.$label.on("click",function(){e(this).addClass("active"),e(this).next(".materialize-tags").find("input.n-tag").focus()}),this.$input.on("focus",function(){var a=e(this).parents(".materialize-tags").parent().find("label");e(this).parents(".materialize-tags").addClass("active"),a.hasClass("active")||a.addClass("active")}).on("focusout",function(){var a=e(this).parents(".materialize-tags"),t=a.find("span.chip");a.removeClass("active"),0==t.length&&a.parent().find("label").removeClass("active")})}function c(e,a){if("function"!=typeof e[a]){var t=e[a];e[a]=function(e){return e[t]}}}function m(e,a){if("function"!=typeof e[a]){var t=e[a];e[a]=function(){return t}}}function s(e){return e?o.text(e).html():""}function p(e){var a=0;if(document.selection){e.focus();var t=document.selection.createRange();t.moveStart("character",-e.value.length),a=t.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(a=e.selectionStart);return a}function u(a,t){var n=!1;return e.each(t,function(e,t){if("number"==typeof t&&a.which===t)return n=!0,!1;if(a.which===t.which){var d=!t.hasOwnProperty("altKey")||a.altKey===t.altKey,l=!t.hasOwnProperty("shiftKey")||a.shiftKey===t.shiftKey,i=!t.hasOwnProperty("ctrlKey")||a.ctrlKey===t.ctrlKey;if(d&&l&&i)return n=!0,!1}}),n}var a={tagClass:t,itemValue:n,itemText:d,itemTitle:l,freeInput:!0,addOnBlur:!0,maxTags:void 0,maxChars:void 0,confirmKeys:[9,13,44],onTagExists:i,trimValue:!0,allowDuplicates:!1};r.prototype={constructor:r,add:function(a,t,n){var d=this;if(!(d.options.maxTags&&d.itemsArray.length>=d.options.maxTags)&&(a===!1||a)){if("string"==typeof a&&d.options.trimValue&&(a=e.trim(a)),"object"==typeof a&&!d.objectItems)throw"Can't add objects when itemValue option is not set";if(!a.toString().match(/^\s*$/)){if("string"==typeof a&&"INPUT"===this.$element[0].tagName){var l=a.split(",");if(l.length>1){for(var i=0;i<l.length;i++)this.add(l[i],!0);return void(t||d.pushVal())}}var r=d.options.itemValue(a),c=d.options.itemText(a),m=d.options.tagClass(a),o=d.options.itemTitle(a),p=e.grep(d.itemsArray,function(e){return d.options.itemValue(e)===r})[0];if(!p||d.options.allowDuplicates){if(!(d.items().toString().length+a.length+1>d.options.maxInputLength)){var v=e.Event("beforeItemAdd",{item:a,cancel:!1,options:n});if(d.$element.trigger(v),!v.cancel){d.itemsArray.push(a);var h=e('<span class="'+s(m)+(null!==o?'" title="'+o:"")+'">'+s(c)+'  <i class="mdi mdi-close pointer" data-role="remove"></i></span>');h.data("item",a),d.findInputWrapper().before(h),h.after(" "),t||d.pushVal(),(d.options.maxTags===d.itemsArray.length||d.items().toString().length===d.options.maxInputLength)&&d.$container.addClass("materialize-tags-max"),d.$element.trigger(e.Event("itemAdded",{item:a,options:n}))}}}else if(d.options.onTagExists){var u=e(".tag",d.$container).filter(function(){return e(this).data("item")===p});d.options.onTagExists(a,u)}}}},remove:function(a,t,n){var d=this;if(d.objectItems&&(a="object"==typeof a?e.grep(d.itemsArray,function(e){return d.options.itemValue(e)==d.options.itemValue(a)}):e.grep(d.itemsArray,function(e){return d.options.itemValue(e)==a}),a=a[a.length-1]),a){var l=e.Event("beforeItemRemove",{item:a,cancel:!1,options:n});if(d.$element.trigger(l),l.cancel)return;e(".chip",d.$container).filter(function(){return e(this).data("item")===a}).remove(),-1!==e.inArray(a,d.itemsArray)&&d.itemsArray.splice(e.inArray(a,d.itemsArray),1)}t||d.pushVal(),d.options.maxTags>d.itemsArray.length&&d.$container.removeClass("materialize-tags-max"),d.$element.trigger(e.Event("itemRemoved",{item:a,options:n}))},removeAll:function(){var a=this;for(e(".chip",a.$container).remove();a.itemsArray.length>0;)a.itemsArray.pop();a.pushVal()},refresh:function(){var a=this;e(".chip",a.$container).each(function(){var t=e(this),n=t.data("item"),l=(a.options.itemValue(n),a.options.itemText(n)),i=a.options.tagClass(n);t.attr("class",null),t.addClass("tag "+s(i)),t.contents().filter(function(){return 3==this.nodeType})[0].nodeValue=s(l)})},items:function(){return this.itemsArray},pushVal:function(){var a=this,t=e.map(a.items(),function(e){return a.options.itemValue(e).toString()});a.$element.val(t,!0).trigger("change")},build:function(t){var n=this;if(n.options=e.extend({},a,t),n.objectItems&&(n.options.freeInput=!1),c(n.options,"itemValue"),c(n.options,"itemText"),m(n.options,"tagClass"),n.options.typeaheadjs){var d=null,l={},i=n.options.typeaheadjs;e.isArray(i)?(d=i[0],l=i[1]):l=i,n.$input.typeahead(d,l).on("typeahead:selected",e.proxy(function(e,a){l.valueKey?n.add(a[l.valueKey]):n.add(a),n.$input.typeahead("val","")},n))}n.$container.on("click",e.proxy(function(e){n.$element.attr("disabled")||n.$input.removeAttr("disabled"),n.$input.focus()},n)),n.options.addOnBlur&&n.options.freeInput&&n.$input.on("focusout",e.proxy(function(a){0===e(".typeahead, .twitter-typeahead",n.$container).length&&(n.add(n.$input.val()),n.$input.val(""))},n)),n.$container.on("keydown","input",e.proxy(function(a){var t=e(a.target),d=n.findInputWrapper();if(n.$element.attr("disabled"))return void n.$input.attr("disabled","disabled");switch(a.which){case 8:if(0===p(t[0])){var l=d.prev();l&&n.remove(l.data("item"))}break;case 46:if(0===p(t[0])){var i=d.next();i&&n.remove(i.data("item"))}break;case 37:var r=d.prev();0===t.val().length&&r[0]&&(r.before(d),t.focus());break;case 39:var c=d.next();0===t.val().length&&c[0]&&(c.after(d),t.focus())}var m=t.val().length;Math.ceil(m/5);t.attr("size",Math.max(this.inputSize,t.val().length))},n)),n.$container.on("keydown","input",e.proxy(function(a){var t=e(a.target);if(n.$element.attr("disabled"))return void n.$input.attr("disabled","disabled");var d=t.val(),l=n.options.maxChars&&d.length>=n.options.maxChars;n.options.freeInput&&(u(a,n.options.confirmKeys)||l)&&(n.add(l?d.substr(0,n.options.maxChars):d),t.val(""),a.preventDefault());var i=t.val().length;Math.ceil(i/5);t.attr("size",Math.max(this.inputSize,t.val().length))},n)),n.$container.on("click","[data-role=remove]",e.proxy(function(a){n.$element.attr("disabled")||n.remove(e(a.target).closest(".chip").data("item"))},n)),n.options.itemValue===a.itemValue&&"INPUT"===n.$element[0].tagName&&n.add(n.$element.val())},destroy:function(){var e=this;e.$container.off("keydown","input"),e.$container.off("click","[role=remove]"),e.$container.remove(),e.$element.removeData("materialtags"),e.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var a=this.$input[0],t=this.$container[0];a&&a.parentNode!==t;)a=a.parentNode;return e(a)}},e.fn.materialtags=function(a,t,n){var d=[];return this.each(function(){var l=e(this).data("materialtags");if(l)if(a||t){if(void 0!==l[a]){if(3===l[a].length&&void 0!==n)var i=l[a](t,null,n);else var i=l[a](t);void 0!==i&&d.push(i)}}else d.push(l);else l=new r(this,a),e(this).data("materialtags",l),d.push(l),e(this).val(e(this).val())}),"string"==typeof a?d.length>1?d:d[0]:d},e.fn.materialtags.Constructor=r;var o=e("<div />");e(function(){e("input[data-role=materialtags]").materialtags()})}(window.jQuery);