function PagObra(){this.construtor=function(){pagina.setTitle("Obra"),this.montaPagHtml()},this.inChat=void 0;var e,t,a,o,i,l,d,r;this.montaPagHtml=function(){if(window.localStorage.getItem("usuario")){if(document.getElementById("btnVoltar").addEventListener("click",function(){pagina.abrirPaginas("main")}),console.log("Pagina Obra será carregada"),l=new Obra,listaParceirosJaAdicionados=new Array,l.json(JSON.parse(window.localStorage.getItem("obra"))),l){var n=JSON.parse(window.localStorage.getItem("token")),c=n.usuario_id;c==l.getIdUsuario()?(t=!0,a=void 0):(t=!1,i=new RelacaoObra,i.json(JSON.parse(window.localStorage.getItem("parceiroConsultarObra")))&&(console.log("DEPURAR RELACAO"),console.log(i),"pendente"==i.getEstado()?a="pendente":"aceita"==i.getEstado()?(console.log("_+_+É ACEITA____"),a="andamento"):a="concluida")),pagina.setTitle(l.getNome()),pagina.getPagina().empty();var s=document.createElement("main"),m=document.createElement("div");m.className="parallax-container container-small row rowCover",m.setAttribute("style","display:flex");var p=document.createElement("div");p.className="col s12",p.setAttribute("style","align-self:center");var u=document.createElement("span");u.className="white-text",u.style.fontSize="1.2em",u.appendChild(document.createTextNode(l.getNome())),p.appendChild(u),m.appendChild(p);var g=document.createElement("div");g.className="parallax";var v=document.createElement("img");l.getFoto()?v.style.background="url('images/filter.png'),url("+pagina.uploadedObraImages()+l.getFoto()+")":v.style.background="url('images/filter.png'),url(images/bg/bgObra.jpg)",g.appendChild(v),m.appendChild(g),s.appendChild(m);var f=document.createElement("div");f.className="row";var h=document.createElement("div");h.className="col s12";var y=document.createElement("ul");y.className="tabs";var E=document.createElement("li"),N=document.createElement("a");N.href="#test1",N.className="teal-text",N.className="active",N.appendChild(document.createTextNode("Info")),E.appendChild(N),y.appendChild(E);var b=document.createElement("li");b.className="tab col s6";var C=document.createElement("a");if(C.href="#test2",C.style.color="#029688",C.appendChild(document.createTextNode("Envolvidos")),b.appendChild(C),t||"pendente"!=a?(E.className="tab col s6",y.appendChild(b)):E.className="tab col s12",i){var P=document.createElement("li");P.className="tab col s3";var T=document.createElement("a");T.href="#test3",T.style.color="#029688",T.appendChild(document.createTextNode("Chat")),P.appendChild(T),y.appendChild(P)}h.appendChild(y),f.appendChild(h),o=document.createElement("div"),o.id="test1",o.className="col s12",t?(this.carregaBotoesSolicitante(),this.carregaBotaoEditarObra(o)):this.carregaBotoesParceiro();var B=document.createElement("div");B.className="row card";var w=document.createElement("div");w.className="col s12";var I=document.createElement("span");I.style.fontSize="0.7em",I.appendChild(document.createTextNode("ANDAMENTO"));var x=document.createElement("p");x.appendChild(I),x.appendChild(document.createElement("br")),x.appendChild(document.createTextNode(l.getAndamento())),w.appendChild(x),B.appendChild(w);var w=document.createElement("div");w.className="col s12";var I=document.createElement("span");I.style.fontSize="0.7em",I.appendChild(document.createTextNode("DESCRIÇÃO"));var x=document.createElement("p");x.appendChild(I),x.appendChild(document.createElement("br")),x.appendChild(document.createTextNode(l.getDescricao())),w.appendChild(x),B.appendChild(w);var w=document.createElement("div");w.className="col s6";var I=document.createElement("span");I.style.fontSize="0.7em",I.appendChild(document.createTextNode("DATA"));var x=document.createElement("p");if(x.appendChild(I),x.appendChild(document.createElement("br")),l.getData()){var S=l.getData();x.appendChild(document.createTextNode(S.getDate()+"/"+(S.getMonth()+1)+"/"+S.getFullYear()))}w.appendChild(x),B.appendChild(w);var w=document.createElement("div");w.className="col s6";var I=document.createElement("span");I.style.fontSize="0.7em",I.appendChild(document.createTextNode("LOCAL"));var x=document.createElement("p");x.appendChild(I),x.appendChild(document.createElement("br")),x.appendChild(document.createTextNode(l.getLocal())),w.appendChild(x),B.appendChild(w);var w=document.createElement("div");w.className="col s12";var I=document.createElement("span");I.style.fontSize="0.7em",I.appendChild(document.createTextNode("NECESSIDADES"));var x=document.createElement("p");if(x.style.wordWrap="break-word",x.appendChild(I),x.appendChild(document.createElement("br")),x.appendChild(document.createTextNode(l.getListaTags())),w.appendChild(x),B.appendChild(w),o.appendChild(B),f.appendChild(o),t||"pendente"!=a){if(e=document.createElement("div"),e.className="col s12",e.id="test2",e.setAttribute("style","margin-bottom:4em !important"),this.carregarParceiros(l),t){d=document.createElement("div"),d.className="center col s12",d.style.margin="0.5em";var k=document.createElement("a");k.className="waves-effect waves-light btn btn-large btn-xl green darken-1",k.appendChild(document.createTextNode("+ Adicionar Novo Parceiro")),k.addEventListener("click",function(){controleAux=l,pagina.abrirPaginas("escolheParceiro")}),d.appendChild(k)}var A=document.createElement("footer");A.setAttribute("style","bottom:-16px !important; z-index: 1000;");var L=document.createElement("div");L.className="row";var U=document.createElement("a");U.className="waves-effect waves-teal btn btn-large btn-xl white-text",U.appendChild(document.createTextNode("Adicionar Novos Parceiros")),U.addEventListener("click",function(){controleAux=l,window.localStorage.setItem("obraAdicionarParceiros",l.jsonString()),pagina.abrirPaginas("escolheParceiro")}),L.appendChild(U),A.appendChild(L),t&&e.appendChild(A),f.appendChild(e)}else;if(r=document.createElement("div"),r.className="col s12",r.id="test3",this.conectarInChat()){var z=document.createElement("footer"),B=document.createElement("div");B.className="row",B.setAttribute("style","display:flex"),B.setAttribute("style","margin:0em !important");var w=document.createElement("col");w.className="input-field col s9";var H=document.createElement("input");H.id="mensagem",H.type="text",H.className="validate",H.addEventListener("keyup",function(e){("Enter"==e.key||13==e.keyCode)&&(pag.inChat.enviar(document.getElementById("mensagem").value),document.getElementById("mensagem").value="")}),w.appendChild(H);var O=document.createElement("label");O.htmlFor="mensagem",O.appendChild(document.createTextNode("Escreva uma mensagem")),w.appendChild(O),B.appendChild(w);var w=document.createElement("div");w.className="col s3",w.setAttribute("style","align-self:center");var F=document.createElement("a");F.id="btnOrcamento",F.className="btn-floating btn-large waves-effect waves-light teal right",F.addEventListener("click",function(){document.getElementById("mensagem").value.length>0&&(pag.inChat.enviar(document.getElementById("mensagem").value),document.getElementById("mensagem").value="")});var _=document.createElement("i");_.className="mdi mdi-send",F.appendChild(_),w.appendChild(F),B.appendChild(w),z.appendChild(B),r.appendChild(z),$(".modal-trigger").leanModal()}else{var B=document.createElement("div");B.className="row card pointer";var x=document.createElement("p");x.style.margin="1em 0em",x.appendChild(document.createTextNode("Erro ao carregar chat.")),B.appendChild(x),r.appendChild(B)}i&&f.appendChild(r),s.appendChild(f),pagina.getPagina().appendChild(s)}else console.log("Erro ao carregar obra.");$("ul.tabs").tabs(),$(".parallax").parallax()}else pagina.abrirPaginas("login")},this.carregaBotoesSolicitante=function(){var e=document.createElement("div");e.className="row card pointer";var t=document.createElement("div");if(t.className="col s12",t.style.padding="0.5em","criada"==l.getAndamento()){var a=document.createElement("div");a.className="col s6 waves-effect waves-green pointer",a.style.padding="0em !important",d=document.createElement("div"),d.className="col s12 center";var i=(document.createElement("span"),document.createElement("i"));i.className="mdi mdi-wrench",i.style.fontSize="1.4em",d.appendChild(i),a.appendChild(d);var d=document.createElement("div");d.className="col s12 center";var r=document.createElement("span");r.appendChild(document.createTextNode("Iniciar Obra")),d.appendChild(r),a.appendChild(d),a.addEventListener("click",function(){swal({title:"Deseja iniciar essa obra?",type:"warning",showCancelButton:!0,confirmButtonColor:"#009688",confirmButtonText:"Iniciar",cancelButtonText:"Cancelar",closeOnConfirm:!1},function(e){if(e){var t=new HttpReq("POST",pagina.apiUrl()+"obra/atualizarAndamento",function(e){e.err?alerta.abrirErro(e.err):(l.setAndamento("iniciada"),window.localStorage.setItem("obra",l.jsonString()),pag.montaPagHtml())});t.enviar("idObra="+l.getId()+"&andamento=iniciada"),swal("Obra Iniciada","","success")}})}),t.appendChild(a)}else if("iniciada"==l.getAndamento()){var a=document.createElement("div");a.className="col s4 waves-effect waves-yellow pointer",a.style.padding="0em !important",d=document.createElement("div"),d.className="col s12 center";var i=(document.createElement("span"),document.createElement("i"));i.className="mdi mdi-pause",i.style.fontSize="1.4em",d.appendChild(i),a.appendChild(d);var d=document.createElement("div");d.className="col s12 center";var r=document.createElement("span");r.appendChild(document.createTextNode("Pausar Obra")),d.appendChild(r),a.appendChild(d),a.addEventListener("click",function(){swal({title:"Deseja pausar essa obra?",type:"warning",showCancelButton:!0,confirmButtonColor:"#009688",confirmButtonText:"Pausar",cancelButtonText:"Cancelar",closeOnConfirm:!1},function(e){if(e){var t=new HttpReq("POST",pagina.apiUrl()+"obra/atualizarAndamento",function(e){e.err?alerta.abrirErro(e.err):(l.setAndamento("pausada"),window.localStorage.setItem("obra",l.jsonString()),pag.montaPagHtml())});t.enviar("idObra="+l.getId()+"&andamento=pausada"),swal("Obra Pausada","","success")}})}),t.appendChild(a);var a=document.createElement("div");a.className="col s4 waves-effect waves-teal pointer",a.style.padding="0em !important",d=document.createElement("div"),d.className="col s12 center";var i=(document.createElement("span"),document.createElement("i"));i.className="mdi mdi-domain",i.style.fontSize="1.4em",d.appendChild(i),a.appendChild(d);var d=document.createElement("div");d.className="col s12 center";var r=document.createElement("span");r.appendChild(document.createTextNode("Finalizar Obra")),d.appendChild(r),a.appendChild(d),a.addEventListener("click",function(){swal({title:"Deseja finalizar essa obra?",type:"warning",showCancelButton:!0,confirmButtonColor:"#009688",confirmButtonText:"Finalizar",cancelButtonText:"Cancelar",closeOnConfirm:!1},function(e){if(e){var t=new HttpReq("POST",pagina.apiUrl()+"obra/atualizarAndamento",function(e){e.err?alerta.abrirErro(e.err):(l.setAndamento("concluida"),window.localStorage.setItem("obra",l.jsonString()),pag.montaPagHtml())});t.enviar("idObra="+l.getId()+"&andamento=concluida"),swal("Obra Finalizada","","success")}})}),t.appendChild(a)}else if("pausada"==l.getAndamento()){var a=document.createElement("div");a.className="col s6 waves-effect waves-green pointer",a.style.padding="0em !important",d=document.createElement("div"),d.className="col s12 center";var i=(document.createElement("span"),document.createElement("i"));i.style.fontSize="1.4em;",i.className="mdi mdi-domain",d.appendChild(i),a.appendChild(d);var d=document.createElement("div");d.className="col s12 center";var r=document.createElement("span");r.appendChild(document.createTextNode("Retomar Obra")),d.appendChild(r),a.appendChild(d),a.addEventListener("click",function(){swal({title:"Deseja retomar essa obra?",type:"warning",showCancelButton:!0,confirmButtonColor:"#009688",confirmButtonText:"Retomar",cancelButtonText:"Cancelar",closeOnConfirm:!1},function(e){if(e){var t=new HttpReq("POST",pagina.apiUrl()+"obra/atualizarAndamento",function(e){e.err?alerta.abrirErro(e.err):(l.setAndamento("iniciada"),window.localStorage.setItem("obra",l.jsonString()),pag.montaPagHtml())});t.enviar("idObra="+l.getId()+"&andamento=iniciada"),swal("Obra Retomada","","success")}})}),t.appendChild(a)}var a=document.createElement("div");"iniciada"==l.getAndamento()?a.className="col s4 waves-effect waves-red pointer":"concluida"==l.getAndamento()?a.className="col s12 waves-effect waves-red pointer":a.className="col s6 waves-effect waves-red pointer",d=document.createElement("div"),d.className="col s12 center",d.style.padding="0em !important";var i=(document.createElement("span"),document.createElement("i"));i.className="mdi mdi-close",i.style.fontSize="1.4em",d.appendChild(i),a.appendChild(d);var d=document.createElement("div");d.className="col s12 center";var r=document.createElement("span");r.appendChild(document.createTextNode("Excluir Obra")),d.appendChild(r),a.appendChild(d),a.addEventListener("click",function(){swal({title:"Deseja excluir essa obra?",text:"Essa operação não poderá ser desfeita.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Excluir",cancelButtonText:"Cancelar",closeOnConfirm:!1,closeOnCancel:!1},function(e){if(e){var t=new HttpReq("POST",pagina.apiUrl()+"obra/atualizarAndamento",function(e){if(e.err)alerta.abrirErro(e.err);else{var t=new HttpReq("POST",pagina.apiUrl()+"obra/remove",function(e){e.err?alerta.abrirErro(e.err):pagina.abrirPaginas("main")});t.enviar("idObra="+l.getId())}});t.enviar("idObra="+l.getId()+"&andamento=cancelada"),swal("Obra Excluída!","Clique no botão abaixo para continuar.","success")}else swal("Operação Cancelada","Clique no botão abaixo para continuar.","error")})}),t.appendChild(a),e.appendChild(t),o.appendChild(e)},this.carregaBotoesParceiro=function(){var e=document.createElement("div");e.className="row card pointer";var t=document.createElement("div");t.className="col s12";var n=document.createElement("div");n.className="col s6 waves-effect waves-green pointer",n.style.padding="0em !important",r=document.createElement("div"),r.className="col s12 center";var d=(document.createElement("span"),document.createElement("i"));d.style.fontSize="1.4em;",d.className="mdi mdi-check",r.appendChild(d),n.appendChild(r);var r=document.createElement("div");r.className="col s12 center";var c=document.createElement("span");c.appendChild(document.createTextNode("Aceitar Obra")),r.appendChild(c),n.appendChild(r),n.addEventListener("click",function(){if(confirm("Deseja aceitar essa obra?")){var e=new HttpReq("POST",pagina.apiUrl()+"relacaoObra/responder",function(e){e.err?alerta.abrirErro("Erro ao responder proposta de obra."):(i.setEstado("aceita"),window.localStorage.setItem("parceiroConsultarObra",i.jsonString()),pag.montaPagHtml())});e.enviar("idRelacaoObra="+i.getId()+"&resposta=aceita")}});var s=document.createElement("div");s.className="col s6 waves-effect waves-red pointer",s.style.padding="0em !important",r=document.createElement("div"),r.className="col s12 center";var d=(document.createElement("span"),document.createElement("i"));d.style.fontSize="1.4em;",d.className="mdi mdi-close",r.appendChild(d),s.appendChild(r);var r=document.createElement("div");r.className="col s12 center";var c=document.createElement("span");c.appendChild(document.createTextNode("Rejeitar Obra")),r.appendChild(c),s.appendChild(r),s.addEventListener("click",function(){if(confirm("Deseja rejeitar essa obra?")){var e=new HttpReq("POST",pagina.apiUrl()+"relacaoObra/responder",function(e){e.err?alerta.abrirErro(e.err):(window.localStorage.setItem("parceiroConsultarObra",void 0),pagina.abrirPaginas("main"))});e.enviar("idRelacaoObra="+i.getId()+"&resposta=rejeitada")}});var m=document.createElement("p");if("pendente"==a)t.appendChild(n),t.appendChild(s);else if("andamento"==a){var p=document.createElement("span");p.className="col s6 center",p.style.fontSize="0.9em",p.appendChild(document.createTextNode("VOCE JA FAZ PARTE DESTA OBRA"));var u=document.createElement("a");u.className="waves-effect waves-light btn",u.appendChild(document.createTextNode("Abandonar Obra")),u.addEventListener("click",function(){if(confirm("Deseja abandonar essa obra?")){var e=new HttpReq("POST",pagina.apiUrl()+"relacaoObra/responder",function(e){e.err?alerta.abrirErro(e.err):(window.localStorage.setItem("parceiroConsultarObra",void 0),pagina.abrirPaginas("main"))});e.enviar("idRelacaoObra="+i.getId()+"&resposta=abandonada")}}),m.appendChild(p),m.appendChild(s)}t.appendChild(m),e.appendChild(t),o.appendChild(e)},this.carregarParceiros=function(e){console.log("Carregando parceiros"),index=0;var t=new HttpReq("POST",pagina.apiUrl()+"relacaoObra/buscarRelacoesDaObra",function(e){var t=JSON.parse(e);if(t=t.result){var a;if(t.length>0){console.log("Array"),console.log(t);for(var n=0;n<t.length;n++)if(a=new RelacaoObra,a.json(t[n]),a){console.log("Relacao obra Carregada");var i,o=a.getIdUsuarioPrestador(),l=new HttpReq("POST",pagina.apiUrl()+"usuario/getUsuario",function(e){if(e=JSON.parse(e),e.result&&(i=new Usuario,i.json(e.result),i)){for(var a=i.getId(),n=new RelacaoObra,o=0;o<t.length&&(n.json(t[o]),n.getIdUsuarioPrestador()!=a);o++);console.log("Parceiro carregado"),listaParceirosJaAdicionados.push(i),pag.adicionarParceiro(i,n)}});console.log(a),l.enviar("usuarioId="+JSON.stringify(o))}}}});t.enviar("idObra="+JSON.stringify(e.getId()))},this.adicionarParceiro=function(a,n){var o=document.createElement("div");o.className="row card pointer centralizacaoVertical",t&&o.addEventListener("click",function(){"rejeitada"!=n.getEstado()&&(window.localStorage.setItem("usuarioParceiroVerPerfil",a.jsonString()),window.localStorage.setItem("relacaoObraVerPerfil",n.jsonString()),parceiroAux=a,pagina.abrirPaginas("parceiro"))});var i=document.createElement("div");i.className="col s3";var l=document.createElement("img");a.getFoto()?l.src=pagina.uploadedUserImages()+a.getFoto():l.src="images/fulano2.png",l.className="responsive-img circle",l.style.margin="0.6em 0em",i.appendChild(l),o.appendChild(i),i=document.createElement("div"),i.className="col s9";var d=document.createElement("p");d.style.margin="1em 0em",d.appendChild(document.createTextNode(a.getNome())),d.appendChild(document.createElement("br"));var r=document.createElement("span");r.style.fontSize="0.7em",console.log("RELACAO OBRA GET ESTADO"),console.log(n),r.appendChild(document.createTextNode(n.getEstado())),d.appendChild(r),i.appendChild(d),o.appendChild(i),e.appendChild(o)},this.addNovaMensagemOutro=function(e,t){var a=document.createElement("div");a.className="row mensagemRecebida";var n=document.createElement("div");n.className="col s11";var o=document.createElement("div");o.className="row";var i=document.createElement("div");i.className="col left  teal lighten-5 textoMensagem";var l=document.createElement("p");l.className="right",l.appendChild(document.createTextNode(e)),i.appendChild(l),o.appendChild(i),n.appendChild(o);var d=document.createElement("div");d.className="row";var c=document.createElement("div");c.className="col s12";var s=document.createElement("p");s.className="right horaMensagem",s.appendChild(document.createTextNode(t)),c.appendChild(s),d.appendChild(c),n.appendChild(d),a.appendChild(n),r.appendChild(a)},this.addNovaMensagem=function(e,t){var a=document.createElement("div");a.className="row mensagemEnviada";var n=document.createElement("div");n.className="col s11 offset-s1";var o=document.createElement("div");o.className="row";var i=document.createElement("div");i.className="col right  teal lighten-3 textoMensagem";var l=document.createElement("p");l.className="left",l.appendChild(document.createTextNode(e)),i.appendChild(l),o.appendChild(i),n.appendChild(o);var d=document.createElement("div");d.className="row";var c=document.createElement("div");c.className="col s12";var s=document.createElement("p");s.className="left horaMensagem",s.appendChild(document.createTextNode(t)),c.appendChild(s),d.appendChild(c),n.appendChild(d),a.appendChild(n),r.appendChild(a)},this.tratarHoraMsg=function(e){return e=new Date(e),"Invalid Date"==e.toLocaleDateString()?void 0:e.toLocaleDateString().substr(0,5)+" "+e.toLocaleTimeString().substr(0,5)},this.conectarInChat=function(){return!i||i.getChatId().length<3?!1:(console.log("INCHAT ID"),console.log(i.getChatId()),carregando.abrir(17e3),this.inChat=new InChat(pagina.socketUrl()+"InChat/obra",i.getChatId(),JSON.parse(window.localStorage.getItem("usuario")).nome,function(e){if("#@!:401:Unauthorized"==e.mensagem)alerta.abrirErro("Você não tem acesso a esse chat"),pagina.abrirPaginas("main"),carregando.fechar();else if("#@!:002:Entrou"==e.mensagem)if(e.usuarioId==JSON.parse(window.localStorage.getItem("token")).usuario_id){alerta.abrirSucesso("Você está <i>online</i>.");var t=new HttpReq("post",pagina.apiUrl()+"InChat/obra/mensagem/listar",function(e){"string"==typeof e&&(e=JSON.parse(e)),console.log("InChat/obra/mensagem/listar"),console.log(e),e.err?(pagina.abrirPaginas("main"),alerta.abrirErro("Erro ao buscar as informações do chat. Tente novamente mais tarde.")):e.result.forEach(function(e){e.usuarioId==JSON.parse(window.localStorage.getItem("token")).usuario_id?pag.addNovaMensagem(e.mensagem,pag.tratarHoraMsg(e.data)):pag.addNovaMensagemOutro(e.mensagem,pag.tratarHoraMsg(e.data))}),carregando.fechar()});t.enviar("chatId="+i.getChatId())}else alerta.abrirAviso(e.nick+" <i>online</i>");else"#@!:003:Saiu"==e.mensagem?e.usuarioId==JSON.parse(window.localStorage.getItem("token")).usuario_id?(alerta.abrirErro("Você foi desconectado da conversa. Erro: 999."),console.log("Você foi desconectado da conversa. Erro: 999."),pagina.abrirPaginas("main")):alerta.abrirAviso(e.nick+" <i>offline</i>"):e.usuarioId==JSON.parse(window.localStorage.getItem("token")).usuario_id?pag.addNovaMensagem(e.mensagem,pag.tratarHoraMsg(e.data)):pag.addNovaMensagemOutro(e.mensagem,pag.tratarHoraMsg(e.data))}),this.inChat?!0:!1)},this.carregaBotaoEditarObra=function(e){var t=document.createElement("div");t.className="row card pointer";var a=document.createElement("div");a.className="col s12";var n=document.createElement("div");n.className="col s12 waves-effect waves-blue pointer",n.style.padding="0em !important",d=document.createElement("div"),d.className="col s12 center";var i=(document.createElement("span"),document.createElement("i"));i.style.fontSize="1.4em",i.className="mdi mdi-pencil",d.appendChild(i),n.appendChild(d);var d=document.createElement("div");d.className="col s12 center";var r=document.createElement("span");r.appendChild(document.createTextNode("Editar Obra")),d.appendChild(r),n.appendChild(d),n.addEventListener("click",function(){obraEditar=l,pagina.abrirPaginas("addObra")}),a.appendChild(n),t.appendChild(a),e.appendChild(t)},this.construtor()}