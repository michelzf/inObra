function PagEscolheParceiro(){this.construtor=function(){pagina.setTitle("Escolhe Parceiro"),this.montaPagHtml()};var e,a,t,n,o;this.buscaComNome=function(){var e=document.getElementById("search").value;if(!(e.length<=3)){var t=new HttpReq("POST",pagina.apiUrl()+"tags/getUsuariosComNome",function(e){var a,t=JSON.parse(e).result;if(t.length>0?n.innerHTML="":(n.innerHTML="",pag.carregarParceiros()),t){console.log(t);for(var o=0;o<t.length;o++){a=new Usuario;var i;a.json(t[o])&&(i=new Usuario,i.json(t[o]),pag.parceiroJaExiste(i)||pag.adicionarParceiroNaLista(i))}}});console.log("t"),console.log(e),t.enviar("nome="+e+"&tags="+JSON.stringify(a.getListaTags()))}},this.montaPagHtml=function(){if(window.localStorage.getItem("usuario")){document.getElementById("btnVoltar").addEventListener("click",function(){a?pagina.abrirPaginas("addObra"):pagina.abrirPaginas("obra")}),t=new Array,pagina.getPagina().empty(),e=document.createElement("main"),e.className="row container",e.setAttribute("style","margin-top: 6em !important;margin-bottom:5em !important;");var i=document.createElement("nav");i.className="grey lighten-1";var l=document.createElement("div");l.className="nav-wrapper";var r=document.createElement("form"),d=document.createElement("div");d.className="input-field",o=document.createElement("input"),o.id="search",o.type="text",d.appendChild(o),o.addEventListener("keydown",function(){pag.buscaComNome()});var c=document.createElement("label");c.htmlFor="search",c.id="searchLabel";var s=document.createElement("i");s.className="mdi-action-search",c.appendChild(s),d.appendChild(c);var m=document.createElement("i");m.className="mdi-navigation-close",d.appendChild(m),r.appendChild(d),l.appendChild(r),i.appendChild(l),e.appendChild(i),pagina.getPagina().appendChild(e),n=document.createElement("div"),this.carregarParceiros(),e.appendChild(n);var p=document.createElement("footer");p.setAttribute("style","bottom:-16px !important;");var u=document.createElement("div");u.className="row";var g=document.createElement("a");g.className="waves-effect waves-teal btn btn-large btn-xl white-text",g.appendChild(document.createTextNode("Concluir")),g.addEventListener("click",function(){a=new Obra,a.json(window.localStorage.getItem("obraAdicionarParceiros")),controleAux&&a.json(controleAux),pag.concluirAcao(a)}),u.appendChild(g),p.appendChild(u),pagina.getPagina().appendChild(p)}else pagina.abrirPaginas("login")},this.carregarParceiros=function(){if(a=new Obra,a.json(window.localStorage.getItem("obraAdicionarParceiros")),(0==a||void 0==a.getId())&&a.json(controleAux),a){var e=new HttpReq("POST",pagina.apiUrl()+"tags/getUsuariosComTags",function(e){var a,t=JSON.parse(e).result;if(console.log(JSON.parse(e)),t)for(var o=0;o<t.length;o++){a=new Usuario;var i;a.json(t[o])&&(i=new Usuario,i.json(t[o]),pag.parceiroJaExiste(i)||pag.adicionarParceiroNaLista(i))}else{var l=document.createElement("div"),r=document.createElement("h4");r.appendChild(document.createTextNode("Sem prestadores disponíveis")),l.appendChild(r),n.appendChild(l)}});e.enviar("tags="+JSON.stringify(a.getListaTags()))}},this.parceiroJaExiste=function(e){var t,a=e.getId();if(listaParceirosJaAdicionados)for(var n=0;n<listaParceirosJaAdicionados.length;n++)if(t=new Usuario,t.json(listaParceirosJaAdicionados[n]),t.getId()==a)return!0;return!1},this.concluirAcao=function(e){if(0==t.length)return pag.paginaIraSair(),window.localStorage.setItem("obra",e.jsonString()),controleAux=void 0,void pagina.abrirPaginas("obra");carregando.abrir();var a=new Obra;if(a.json(window.localStorage.getItem("obraAdicionarParceiros")),controleAux)controleAux&&(console.log("Inicio conclusao de incluir parceiros em obra existente"),t.length>0?pag.enviarRelacoesObras(e):(alerta.abrirErro("Erro ao atualizar parcerios em obra existe."),carregando.fechar()));else{console.log("Inicio conclusao de insersao de nova obra");var n=new HttpReq("POST",pagina.apiUrl()+"InChat/obra/criar",function(a){if(a=JSON.parse(a),a.err)carregando.fechar(),alerta.abrirErro("Erro ao cadastrar obra, erro na criação do chat para a obra.");else{var n=new HttpReq("POST",pagina.apiUrl()+"obra/cadastrar",function(a){a.err?(carregando.fechar(),alerta.abrirErro("Erro ao cadastrar obra"),console.log("Erro ao cadastrar obra")):(e.json(JSON.parse(a))?console.log("Sucesso ao cadastrar obra"):(carregando.fechar(),alerta.abrirErro("Erro ao cadastrar obra"),console.log("Erro ao cadastrar obra")),t.length>0?pag.enviarRelacoesObras(e):(carregando.fechar(),pag.paginaIraSair(),window.localStorage.setItem("obra",e.jsonString()),pagina.abrirPaginas("obra")))});e.setChatId(a.result),console.log(e.getChatId()),console.log("Cadastro de obra com imagem");var o=pagina.dataURItoBlob(imagemObra),i=new FormData;i.append("obraImage",o),i.append("obra",e.jsonString()),n.enviar(i,void 0,!1),imagemObra=void 0}});n.enviar(void 0,!0,!1)}},this.enviarRelacoesObras=function(e){for(var a=0,n=0,o=0,i=0;i<t.length;i++){var l=new HttpReq("POST",pagina.apiUrl()+"InChat/obra/criar",function(i){if(i=JSON.parse(i),i.err)alerta.abrirErro("Erro ao cadastrar relacao obra, erro na criação do chat para a relacao obra."),carregando.fechar(),alerta.abrirErro("Erro ao cadastrar relacao obra, erro na criação do chat para a relacao obra.");else{var l=new HttpReq("POST",pagina.apiUrl()+"InChat/obra/participantes/adicionar",function(o){if(o=JSON.parse(o),o.err)alerta.abrirErro("Erro ao atualizar parcerios em obra existe."),carregando.fechar(),alerta.abrirErro("Erro ao cadastrar relacao obra, erro na autorizacao do chat.");else{var l=new RelacaoObra;l.setIdObra(e.getId()),l.setIdUsuarioPrestador(t[n]),n+=1;var r=new HttpReq("POST",pagina.apiUrl()+"relacaoObra/cadastrar",function(n){n.err?(alerta.abrirErro("Erro ao cadastrar relacao obra"),carregando.fechar(),console.log("Erro ao cadastrar relacao obra")):console.log("Sucesso ao cadastrar relacao obra"),a++,a==t.length&&(carregando.fechar(),pag.paginaIraSair(),window.localStorage.setItem("obra",e.jsonString()),controleAux=void 0,pagina.abrirPaginas("obra"))});l.setChatId(i.result),console.log("Relacao Obra a ser enviada:"),console.log(l),r.enviar("relacaoObra="+l.jsonString(),!0,!1)}});console.log("++++++"+o),console.log(i.result),console.log(t[o]),l.enviar("chatId="+i.result+"&usuarioId="+t[o],!0,!1),o+=1}});l.enviar(void 0,!0,!1)}},this.paginaIraSair=function(){window.localStorage.setItem("obraAdicionarParceiros",!1),window.localStorage.setItem("obraAtualizarParceiros",!1),listaParceirosJaAdicionados=void 0},this.adicionarParceiroNaLista=function(e){var a=new Usuario;a.json(e);var o=a.getNome();o||(o="Sem nome");var i=document.createElement("div");i.className="col s12";var l=document.createElement("div");l.className="row card pointer",l.style.display="flex";var r=document.createElement("div");r.className="col s3",r.addEventListener("click",function(){window.localStorage.setItem("usuarioParceiroVerPerfil",a.jsonString()),pag.alertDadosParceiro(a)});var d=document.createElement("img");a.getFoto()?d.src=pagina.uploadedUserImages()+a.getFoto():d.src="images/obraDefault.png",d.style.height="3em",d.style.width="3em",d.className="responsive-img circle",d.style.margin="0.6em 0em",r.appendChild(d),l.appendChild(r),r=document.createElement("div"),r.className="col s7",r.addEventListener("click",function(){window.localStorage.setItem("usuarioParceiroVerPerfil",a.jsonString()),pag.alertDadosParceiro(a)});var e=document.createElement("p");e.appendChild(document.createTextNode(o)),r.appendChild(e);var e=document.createElement("p");e.style.margin="1em 0em",e.style.fontSize="0.8em",e.appendChild(document.createTextNode(a.getTags())),r.appendChild(e),l.appendChild(r),r=document.createElement("div"),r.className="col s2 centralizacaoVertical",r.setAttribute("style","justify-content: space-between");var c=document.createElement("i");c.className="small mdi mdi-plus green-text pointer",this.parceiroEstaSelecionado(a)&&(c.className="small mdi mdi-minus red-text pointer"),c.addEventListener("click",function(){pag.parceiroEstaSelecionado(a)?(c.className="small mdi mdi-plus green-text pointer",pag.removerParceiro(a)):(c.className="small mdi mdi-minus red-text pointer",t.push(a.getId()))}),r.appendChild(c),l.appendChild(r),i.appendChild(l),n.appendChild(i)},this.abrirUsuarioParceiro=function(e){},this.removerParceiro=function(e){for(var n,a=e.getId(),o=0;o<t.length;o++)n=t[o],a==n&&t.splice(o)},this.parceiroEstaSelecionado=function(e){for(var n,a=e.getId(),o=0;o<t.length;o++)if(n=t[o],a==n)return!0;return!1},this.alertDadosParceiro=function(e){console.log(e),carregando.abrir(17e3);var a=new HttpReq("POST",pagina.apiUrl()+"relacaoObra/buscarRelacoesObraDoPrestador",function(a){if(carregando.fechar(),a.err)alerta.abrirErro(a.err);else{a=JSON.parse(a),console.log(a);for(var t="",n=0,o=0,i=0;i<a.result.length;i++){var l=new RelacaoObra;if(l.json(a.result[i]),l.getAvaliacao()&&(l.getAvaliacao().length>0||"number"==typeof l.getAvaliacao())&&(console.log(l),o+=1,n+=l.getAvaliacao()),l&&l.getComentario()&&l.getComentario().length>0){var r=l.getComentario()+"<br><br>";t+=r}}n/=o;var d=e.getFoto();d=!d||d.length<3?"images/fulano.png":pagina.uploadedUserImages()+d,pai=document.getElementById("modalContainer"),pai.empty();var c=document.createElement("div");c.id="parceiroDados",c.className="modal modal-fixed-footer modalFull";var s=document.createElement("div");s.className="modal-content";var m=document.createElement("div");m.className="row center";var p=document.createElement("img");p.style.width="2.5em",p.src=d,m.appendChild(p);var u=document.createElement("h5");u.appendChild(document.createTextNode(e.getNome())),m.appendChild(u),s.appendChild(m);var g=document.createElement("div");g.className="row";var v=document.createElement("div");v.className="col s12",v.style.wordBreak="break-all";var f=document.createElement("p"),h=document.createElement("span");h.style.fontSize="1em",h.appendChild(document.createTextNode("Descrição")),f.appendChild(h),v.appendChild(f);var y=document.createElement("p");if(y.setAttribute("style","margin-bottom:0.8em !important; font-size:1.2em"),y.appendChild(document.createTextNode(e.getDescricao())),v.appendChild(y),NaN!=n){var E=document.createElement("p"),N=document.createElement("span");if(N.style.fontSize="1em",N.appendChild(document.createTextNode("Avaliação Geral")),E.appendChild(N),v.appendChild(E),console.log(n),n>-1&&9999999>n){var b=document.createElement("span");b.className="rating",b.setAttribute("style","margin-bottom:0.8em !important;"),b.setAttribute("disabled","disabled"),b.setAttribute("data-default-rating",n),b.disabled=!0,v.appendChild(b)}else{var b=document.createElement("span");b.className="black-text",b.appendChild(document.createTextNode("Sem avaliação")),v.appendChild(b),v.appendChild(document.createElement("br")),v.appendChild(document.createElement("br"))}}var C=document.createElement("p"),b=document.createElement("span");b.style.fontSize="1em",b.appendChild(document.createTextNode("Comentários")),C.appendChild(b),v.appendChild(C);var P=document.createElement("p");P.setAttribute("style","margin-bottom:0.8em !important; font-size:1.2em"),P.appendChild(document.createTextNode(t)),v.appendChild(P);var T=document.createElement("p"),b=document.createElement("span");b.style.fontSize="1em",b.appendChild(document.createTextNode("Especialidades")),T.appendChild(b),v.appendChild(T);var B=document.createElement("p");B.setAttribute("style","margin-bottom:0.8em !important; font-size:1.2em"),B.appendChild(document.createTextNode(e.getTags())),v.appendChild(B),g.appendChild(v),s.appendChild(g),c.appendChild(s);var w=document.createElement("div");w.className="modal-footer";var I=document.createElement("a");I.onclick=function(){pag.respostaOrcamento(1)},I.className="modal-action modal-close waves-effect waves-light green-text btn-flat ",I.appendChild(document.createTextNode("Fechar")),w.appendChild(I),c.appendChild(w),pai.appendChild(c);for(var x=document.getElementsByClassName("rating"),i=0;i<x.length;i++){new SimpleStarRating(x[i]);x[i].addEventListener("rate",function(e){console.log("Rating: "+e.detail)})}$("#parceiroDados").openModal()}});a.enviar("idUsuarioPrestador="+e.getId())},this.construtor()}