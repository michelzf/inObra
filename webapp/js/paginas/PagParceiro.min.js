function PagParceiro(){this.construtor=function(){pagina.setTitle("Parceiro"),this.montaPagHtml()},this.inChat=void 0;var e,a,n;this.montaPagHtml=function(){if(pagina.getPagina().empty(),window.localStorage.getItem("usuario"))if("undefined"!=window.localStorage.getItem("usuarioParceiroVerPerfil")){if(n=document.createElement("div"),n.className="col s12",n.style="overflow-y: scroll; height:50px;",e=new Usuario,!e.json(JSON.parse(window.localStorage.getItem("usuarioParceiroVerPerfil"))))return pagina.abrirPaginas("main"),void alerta.abrirErro("Erro ao ver perfil de usuario");window.localStorage.setItem("usuarioParceiroVerPerfil",void 0);var t=new Usuario;parceiroAux&&t.json(parceiroAux),a=new RelacaoObra,a.json(JSON.parse(window.localStorage.getItem("relacaoObraVerPerfil")))||(a=!1),console.log(a),window.localStorage.setItem("relacaoObraVerPerfil",void 0);var r=document.createElement("main"),i=document.createElement("div");i.className="parallax-container container-big",i.style.height="7em !important";var o=document.createElement("div");o.className="center col s12";var l=document.createElement("img");l.style.marginTop="1em",l.style.width="3em",l.style.height="3em",l.className="responsive-img",t.getFoto()?l.src=pagina.uploadedUserImages()+t.getFoto():l.src="images/fulano.png",o.appendChild(l),i.appendChild(o);var d=document.createElement("div");d.className="center col s12";var c=document.createElement("span");c.className="white-text",c.style.fontSize="1.5em",c.appendChild(document.createTextNode(t.getNome())),d.appendChild(c),i.appendChild(d);var s=document.createElement("div");s.className="parallax";var m=document.createElement("img");m.style.background="url('images/filter.png'),url(images/bg/bgParceiro.jpg)",s.appendChild(m),i.appendChild(s),r.appendChild(i);var p=document.createElement("div");p.className="row";var u=document.createElement("div");u.className="col s12";var g=document.createElement("ul");g.className="tabs";var v=document.createElement("li");v.className="tab col s3";var h=document.createElement("a");h.href="#test1",h.className="teal-text active",h.appendChild(document.createTextNode("Informações")),v.appendChild(h),g.appendChild(v);var f=document.createElement("li");f.className="tab col s3";var C=document.createElement("a");C.style.color="#029688",C.appendChild(document.createTextNode("Avaliação")),f.appendChild(C),"pendente"!=a.getEstado()&&(C.href="#test2",g.appendChild(f));var E=document.createElement("li");E.className="tab col s3";var N=document.createElement("a");N.href="#test2","pendente"!=a.getEstado()&&(N.href="#test3"),N.style.color="#029688",N.appendChild(document.createTextNode("Chat")),E.appendChild(N),g.appendChild(E),u.appendChild(g),p.appendChild(u);var b=document.createElement("div");b.id="test1",b.className="col s12";var y=document.createElement("div");y.className="row card pointer";var w=document.createElement("div");w.className="col s12",w.style.padding="0.5em";var x=document.createElement("div");x.className="col s12 waves-effect waves-green pointer",x.style.padding="0em !important";var S=document.createElement("div");S.className="col s12 center";var P=(document.createElement("span"),document.createElement("i"));P.className="mdi mdi-close",P.style.fontSize="1.4em",S.appendChild(P),x.appendChild(S);var S=document.createElement("div");S.className="col s12 center";var T=document.createElement("span");T.appendChild(document.createTextNode("Remover Parceiro da Obra")),S.appendChild(T),x.appendChild(S),x.addEventListener("click",function(){swal({title:"Deseja remover este parceiro da obra?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Confirmar",cancelButtonText:"Cancelar",closeOnConfirm:!1},function(e){if(e){var t=new HttpReq("POST",pagina.apiUrl()+"relacaoObra/removerRelacaoObra",function(e){e.err?alerta.abrirErro(e.err):pagina.abrirPaginas("obra")});t.enviar("idRelacaoObra="+a.getId()),swal("Parceiro removido da obra","","success")}})}),w.appendChild(x),y.appendChild(w),b.appendChild(y);var y=document.createElement("div");y.className="row card",w=document.createElement("div"),w.className="col s12";var O=document.createElement("p"),T=document.createElement("span");T.style.fontSize="0.7em",T.appendChild(document.createTextNode("Descrição")),O.appendChild(T),O.appendChild(document.createElement("br")),w.appendChild(O);var O=document.createElement("p");O.appendChild(document.createTextNode(t.getDescricao())),w.appendChild(O);var O=document.createElement("p"),T=document.createElement("span");T.style.fontSize="0.7em",T.appendChild(document.createTextNode("E-MAIL")),O.appendChild(T),O.appendChild(document.createElement("br")),w.appendChild(O);var O=document.createElement("p");O.appendChild(document.createTextNode(t.getEmail())),w.appendChild(O);var O=document.createElement("p"),T=document.createElement("span");T.style.fontSize="0.7em",T.appendChild(document.createTextNode("Telefone")),O.appendChild(T),O.appendChild(document.createElement("br")),e.getTelefone()?O.appendChild(document.createTextNode(e.getTelefone())):O.appendChild(document.createTextNode("Sem telefone")),w.appendChild(O),y.appendChild(w),b.appendChild(y),p.appendChild(b);var A=document.createElement("div");"pendente"!=a.getEstado()&&(A.id="test2"),A.className="col s12",A.setAttribute("style","margin-bottom:3em");var x=document.createElement("div");x.className="row",O=document.createElement("span"),O.className="col s12",O.setAttribute("style","margin-bottom:1em"),O.appendChild(document.createTextNode("Avalie o serviço do parceiro")),x.appendChild(O);var y=document.createElement("div");y.className="row center";var k=document.createElement("span");k.className="rating",a.getAvaliacao()?(console.log("avaliacao"),console.log(a.getAvaliacao()),k.setAttribute("data-default-rating",a.getAvaliacao())):(console.log(a),k.setAttribute("data-default-rating","0")),y.appendChild(k),x.appendChild(y),A.appendChild(x);var L=document.createElement("div");L.className="row";var B=document.createElement("div");B.className="input-field col s12";var U=document.createElement("textarea");U.className="materialize-textarea",U.id="comentario",B.appendChild(U);var R=document.createElement("label");R.htmlFor="comentarioLabel",R.className="active",R.appendChild(document.createTextNode("Comente a qualidade do serviço")),B.appendChild(R),L.appendChild(B),A.appendChild(L);var F=document.createElement("footer");F.setAttribute("style","bottom:-16px !important;");var j=document.createElement("div");j.className="row";var H=document.createElement("a");if(H.className="waves-effect waves-teal btn btn-large btn-xl white-text",a.getComentario()&&a.getComentario().length>0?(H.appendChild(document.createTextNode("Atualizar Comentário")),U.value=a.getComentario()):H.appendChild(document.createTextNode("Enviar Comentário")),H.addEventListener("click",function(){var e=document.getElementById("comentario").value;e&&0!=e.length?pag.enviarComentario(e):alerta.abrirErro("Preencher comentário antes de enviar.")}),j.appendChild(H),F.appendChild(j),A.appendChild(F),"pendente"!=a.getEstado()&&p.appendChild(A),colChat=document.createElement("div"),colChat.className="col s12",colChat.id="test2","pendente"!=a.getEstado()&&(colChat.id="test3"),colChat.setAttribute("style","margin-top:2em"),div_test4=document.createElement("div"),div_test4.className="col s12",div_test4.id="containerChat",div_test4.style.marginBottom="5em",this.conectarInChat()){var F=document.createElement("footer");F.style.backgroundColor="#f5f5f5";var y=document.createElement("div");y.className="row",y.setAttribute("style","display:flex"),y.setAttribute("style","margin:0em !important");var w=document.createElement("col");w.className="input-field col s9";var z=document.createElement("input");z.id="mensagem",z.type="text",z.className="validate",z.addEventListener("keyup",function(e){("Enter"==e.key||13==e.keyCode)&&(pag.inChat.enviar(document.getElementById("mensagem").value),document.getElementById("mensagem").value="",window.scrollTo(0,document.body.scrollHeight))}),w.appendChild(z);var D=document.createElement("label");D.htmlFor="mensagem",D.appendChild(document.createTextNode("Escreva uma mensagem")),w.appendChild(D),y.appendChild(w);var w=document.createElement("div");w.className="col s3",w.setAttribute("style","align-self:center");var M=document.createElement("a");M.id="btnOrcamento",M.className="btn-floating btn-large waves-effect waves-light teal right",M.addEventListener("click",function(){pag.inChat.enviar(document.getElementById("mensagem").value),document.getElementById("mensagem").value="",window.scrollTo(0,document.body.scrollHeight)});var P=document.createElement("i");P.className="mdi mdi-send",M.appendChild(P),w.appendChild(M),y.appendChild(w),F.appendChild(y),colChat.appendChild(F),$(".modal-trigger").leanModal()}else{var y=document.createElement("div");y.className="row card pointer";var O=document.createElement("p");O.style.margin="1em 0em",O.appendChild(document.createTextNode("Erro ao carregar chat.")),y.appendChild(O),colChat.appendChild(y)}colChat.appendChild(div_test4),p.appendChild(colChat),r.appendChild(p),pagina.getPagina().appendChild(r),$("ul.tabs").tabs(),$(".parallax").parallax();for(var J=document.getElementsByClassName("rating"),P=0;P<J.length;P++){new SimpleStarRating(J[P]);J[P].addEventListener("rate",function(e){console.log("Rating: "+e.detail),pag.enviarAvaliacao(e.detail)})}}else pagina.abrirPaginas("main");else pagina.abrirPaginas("login")},this.enviarComentario=function(e){var t=new HttpReq("post",pagina.apiUrl()+"relacaoObra/comentarRelacaoObra",function(e){"string"==typeof e&&(e=JSON.parse(e)),e.err?alerta.abrirErro("Erro ao comentar serviço."):alerta.abrirSucesso("Enviado com sucesso.")}),n=new FormData;n.append("idRelacaoObra",a.getId()),n.append("comentario",e),t.enviar(n)},this.enviarAvaliacao=function(e){var t=new HttpReq("post",pagina.apiUrl()+"relacaoObra/avaliarRelacaoObra",function(e){"string"==typeof e&&(e=JSON.parse(e)),e.err?alerta.abrirErro("Erro ao avaliar serviço."):alerta.abrirSucesso("Avaliado com sucesso.")}),n=new FormData;n.append("idRelacaoObra",a.getId()),n.append("avaliacao",e),t.enviar(n)},this.addNovaMensagemOutro=function(e,a){var t=document.createElement("div");t.className="row mensagemRecebida";var n=document.createElement("div");n.className="col s11";var r=document.createElement("div");r.className="row";var i=document.createElement("div");i.className="col left  teal lighten-5 textoMensagem";var o=document.createElement("p");o.className="right",o.appendChild(document.createTextNode(e)),i.appendChild(o),r.appendChild(i),n.appendChild(r);var l=document.createElement("div");l.className="row";var d=document.createElement("div");d.className="col s12";var c=document.createElement("p");c.className="left horaMensagem",c.appendChild(document.createTextNode(a)),d.appendChild(c),l.appendChild(d),n.appendChild(l),t.appendChild(n),div_test4.appendChild(t)},this.addNovaMensagem=function(e,a){var t=document.createElement("div");t.className="row mensagemEnviada";var n=document.createElement("div");n.className="col s11 offset-s1";var r=document.createElement("div");r.className="row";var i=document.createElement("div");i.className="col right  teal lighten-3 textoMensagem";var o=document.createElement("p");o.className="left",o.appendChild(document.createTextNode(e)),i.appendChild(o),r.appendChild(i),n.appendChild(r);var l=document.createElement("div");l.className="row";var d=document.createElement("div");d.className="col s12";var c=document.createElement("p");c.className="right horaMensagem",c.appendChild(document.createTextNode(a)),d.appendChild(c),l.appendChild(d),n.appendChild(l),t.appendChild(n),div_test4.appendChild(t)},this.tratarHoraMsg=function(e){return e=new Date(e),"Invalid Date"==e.toLocaleDateString()?void 0:e.toLocaleDateString().substr(0,5)+" "+e.toLocaleTimeString().substr(0,5)},this.conectarInChat=function(){return!a||a.getChatId().length<3?!1:(console.log("INCHAT ID"),console.log(a.getChatId()),carregando.abrir(17e3),this.inChat=new InChat(pagina.socketUrl()+"InChat/obra",a.getChatId(),JSON.parse(window.localStorage.getItem("usuario")).nome,function(e){if("#@!:401:Unauthorized"==e.mensagem)alerta.abrirErro("Você não tem acesso a esse chat"),pagina.abrirPaginas("main"),carregando.fechar();else if("#@!:002:Entrou"==e.mensagem)if(e.usuarioId==JSON.parse(window.localStorage.getItem("token")).usuario_id){alerta.abrirSucesso("Você está <i>online</i>.");var t=new HttpReq("post",pagina.apiUrl()+"InChat/obra/mensagem/listar",function(e){"string"==typeof e&&(e=JSON.parse(e)),console.log("InChat/obra/mensagem/listar"),console.log(e),e.err?(pagina.abrirPaginas("main"),alerta.abrirErro("Erro ao buscar as informações do chat. Tente novamente mais tarde.")):e.result.forEach(function(e){e.usuarioId==JSON.parse(window.localStorage.getItem("token")).usuario_id?pag.addNovaMensagem(e.mensagem,pag.tratarHoraMsg(e.data)):pag.addNovaMensagemOutro(e.mensagem,pag.tratarHoraMsg(e.data))}),carregando.fechar()});t.enviar("chatId="+a.getChatId())}else alerta.abrirAviso(e.nick+" <i>online</i>");else"#@!:003:Saiu"==e.mensagem?e.usuarioId==JSON.parse(window.localStorage.getItem("token")).usuario_id?(alerta.abrirErro("Você foi desconectado da conversa. Erro: 999."),console.log("Você foi desconectado da conversa. Erro: 999."),pagina.abrirPaginas("main")):alerta.abrirAviso(e.nick+" <i>offline</i>"):e.usuarioId==JSON.parse(window.localStorage.getItem("token")).usuario_id?pag.addNovaMensagem(e.mensagem,pag.tratarHoraMsg(e.data)):pag.addNovaMensagemOutro(e.mensagem,pag.tratarHoraMsg(e.data))}),this.inChat?!0:!1)},this.construtor()}